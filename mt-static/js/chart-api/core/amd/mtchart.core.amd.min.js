(function(t,e){if("object"==typeof exports){var i=require("jquery");module.exports=e(i)}else"function"==typeof define&&define.amd&&define(["jquery"],e)})(this,function(){(function(t,e){"use strict";var i=e,n={},r=t.MT=t.MT||{};r.ChartAPI=n;n.Data={};n.Data.getData=function(t,e,n,r){var a,s,o,h;t&&t.done(function(t){a||(a="string"==typeof t?""+t:i.isArray(t)?i.map(t,function(t){return i.extend({},t)}):i.extend({},t));n(a)}).fail(function(t){s={404:"Data is not found",403:"Data is forbidden to access"};o="Some error occured in the data fetching process";h=t.status?"error-"+t.status:"error-unknown";r&&(r.$errormsg=i('<div class="error '+h+'">'+(s[t.status]||o)+"</div>").appendTo(e))}).always(function(){r&&r.$progress&&r.$progress.parent().length>0&&r.$progress.remove()}).progress(function(){!r||r.$progress&&0!==r.$progress.parent().length||(r.$progress=i('<div class="progress">fetching data...</div>').appendTo(e))})};n.Data.filterData=function(t,e,r,a,s,o){var h,l={};s=s||1;i.each(t,function(t,u){var c,p;c=n.Date.parse(u.x);if(c&&c>=r&&e>=c)if(o){p=n.Date.createId(c,"daily");l[p]=u}else{"weekly"===a&&(c=n.Date.getWeekStartday(c));p=n.Date.createId(c,a);if(l[p])for(t=0;s>t;t++){h=t?"y"+t:"y";l[p][h]=parseInt(l[p][h],10)+parseInt(u[h],10)}else l[p]=i.extend({},u)}});return l};n.Date={};n.Date.getWeekStartday=function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay())};n.Date.zeroPadArray=function(t,e){var n;({yearly:function(){n=[t.getFullYear()]},monthly:function(){n=[t.getFullYear(),t.getMonth()+1]},quarter:function(){n=[t.getFullYear(),t.getMonth()+1]},weekly:function(){n=[t.getFullYear(),t.getMonth()+1,t.getDate()-t.getDay()]},daily:function(){n=[t.getFullYear(),t.getMonth()+1,t.getDate()]},hourly:function(){n=[t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours()]}})[e]();return i.map(n,function(t){t=""+t;return 1===t.length?"0"+t:t})};n.Date.createId=function(t,e){return n.Date.zeroPadArray(t,e).join("")};n.Date.createXLabel=function(t,e){var i,r,a=n.Date.zeroPadArray(t,e);if("hourly"===e){i=a.pop();r=a.join("-")+" "+i+":00"}else r=a.join("-");return r};n.Date.parse=function(t){var e;e=!t||t instanceof Date?t||null:"number"==typeof t?new Date(t):new Date(Date.parse(""+t));if(e&&/NaN|Invalid Date/.test(""+e)){e=t.replace(/-/g,"/").split("+")[0];if(1===e.split("/").length){e=t.match(/([0-9]{4})([0-9]{1,2})([0-9]{1,2})/);e=[e[1],e[2],e[3]].join("/")}2===e.split("/").length&&(e+="/01");e=i.each(e.split("/"),function(t,e){return 1===e.length?"0"+e:e}).join("/");e=new Date(Date.parse(e))}return e};n.Date.calcDate=function(t,e,i,n){var r,a,s,o;r=t.getFullYear();a=t.getMonth();s=t.getDate();o=0;e-=1;n=n?-1:1;({yearly:function(){r+=n*e},monthly:function(){a+=n*e},quarter:function(){a+=4*n*e},weekly:function(){s=s+7*n*e-t.getDay()},daily:function(){s+=n*e},hourly:function(){o=t.getHours()+n*e}})[i]();return new Date(r,a,s,o)};n.Range={};n.Range.factory=function(t){var e;t=t||{};t.maxLength=t.maxLength||90;t.dataType=t.dataType||"timeline";t.isTimeline=n.Range.isTimeline(t.dataType);e=t.isTimeline?n.Range.calcDate:n.Range.calcNum;return e(t.start,t.end,t.length,t.maxLength,t.unit,t.dataType,t.autoSized)};n.Range.generate=n.Range.factory;n.Range.isTimeline=function(t){return!t||"timeline"===t};n.Range.calcDate=function(t,e,r,a,s,o,h){s=s||"monthly";r=r||("hourly"===s?24:10);if(h){var l=i(window).width();a=Math.min(Math.ceil(.021875*l),a);r=a}t=n.Date.parse(t);e=n.Date.parse(e);t||e||(e=n.Range.getEndDate(new Date,s));t||(t=n.Range.getStartDate(n.Date.calcDate(e,r,s,!0),s));e||(e=n.Range.getEndDate(n.Date.calcDate(t,r,s,!1),s));e>new Date&&(e=new Date);t>e&&(t=e);r=n.Range.getLength(t,e,s);if(r>a){r=a;t=n.Date.calcDate(e,r,s,!0)}return{start:t,end:e,length:r,maxLength:a,unit:s,dataType:o,max:n.Range.getEndDate(e,s),min:n.Range.getStartDate(t,s),isTimeline:!0}};n.Range.calcNum=function(t,e,n,r,a,s,o){n=n||10;if(o){var h=i(window).width();r=Math.min(Math.ceil(.021875*h),r);n=Math.min(n,r)}if(!t&&!e){t=0;e=n-1}t=parseInt(t,10)||(0===t?0:null);e=parseInt(e,10)||(0===e?0:null);if(null===t){t=e-n;0>t&&(t=0)}null===e&&(e=t+n);t>e&&(t=e);n=e-t+1;if(n>r){n=r;t=e-r}return{start:t,end:e,length:n,maxLength:r,dataType:s,unit:null,max:e,min:t,isTimeline:!1}};n.Range.getStartDate=function(t,e){var i,n=t.getFullYear(),r=t.getMonth(),a=t.getDate();({yearly:function(){i=new Date(n,0,1,0,0,0)},monthly:function(){i=new Date(n,r,1,0,0,0)},quarter:function(){i=new Date(n,r,1,0,0,0)},weekly:function(){i=new Date(n,r,a-t.getDay(),0,0,0)},daily:function(){i=new Date(n,r,a,0,0,0)},hourly:function(){i=new Date(n,r,a,t.getHours(),0,0)}})[e]();return i};n.Range.getEndDate=function(t,e){var i,n=t.getFullYear(),r=t.getMonth(),a=t.getDate();({yearly:function(){i=new Date(n,11,31,23,59,59)},monthly:function(){i=new Date(new Date(n,r+1,1,0,0,0).valueOf()-1)},quarter:function(){i=new Date(new Date(n,r+1,1,0,0,0).valueOf()-1)},weekly:function(){i=new Date(n,r,a-t.getDay()+6,23,59,59)},daily:function(){i=new Date(n,r,a,23,59,59)},hourly:function(){i=new Date(n,r,a,t.getHours(),0,0)}})[e]();return new Date>i?i:new Date};n.Range.getNextDate=function(t,e,i,n){var r,a=t.getFullYear(),s=t.getMonth(),o=t.getDate();({yearly:function(t){r=new Date(a+t,0,1)},monthly:function(t){r=new Date(a,s+t,1)},quarter:function(t){r=new Date(a,s+4*t,1)},weekly:function(e){r=new Date(a,s,o+7*e-t.getDay())},daily:function(t){r=new Date(a,s,o+t)},hourly:function(e){r=new Date(a,s,o,t.getHours()+e)}})[n](i);return e>r?r:null};n.Range.getDataRange=function(t,e){var r,a,s;if(e){r=i.map(t,function(t){return n.Date.parse(t.x).valueOf()});a=Math.max.apply(null,r);s=Math.min.apply(null,r)}else{s=0;a=t.length-1}return{max:a,min:s}};n.Range.getLength=function(t,e,i){var r;({yearly:function(){r=Math.ceil(e.getFullYear()-t.getFullYear())},monthly:function(){r=Math.ceil(12*e.getFullYear()+e.getMonth()-(12*t.getFullYear()+t.getMonth()))},quarter:function(){r=Math.ceil((12*e.getFullYear()+e.getMonth()-(12*t.getFullYear()+t.getMonth()))/4)},weekly:function(){r=Math.ceil((n.Date.getWeekStartday(e)-n.Date.getWeekStartday(t))/6048e5)},daily:function(){r=Math.ceil((e-t)/864e5)},hourly:function(){r=Math.ceil((e-t)/36e5)}})[i]();return r>0?r+1:1};n.Graph=function(t,i){this.config=e.extend({type:"morris.bar",staticPath:"",data:"graph.json"},t);this.config.id="graph-"+(new Date).valueOf()+Math.floor(100*Math.random());this.config.yLength=parseInt(this.config.yLength,10)||1;this.range=n.Range.generate(i);if("string"==typeof this.config.data)this.origData_=e.getJSON(this.config.staticPath+this.config.data);else{this.origData_=e.Deferred();this.origData_.resolve(this.config.data)}this.graphData={};this.graphData[this.range.unit]=e.Deferred();this.getData(e.proxy(function(t){this.graphData[this.range.unit].resolve(this.generateGraphData(t))},this));this.$graphContainer=e('<div id="'+this.config.id+'-container" class="graph-container">');this.$graphContainer.on("UPDATE",e.proxy(function(t,i,n){this.update_(i,n);return e(this.$graphContainer)},this));this.$graphContainer.on("REMOVE",e.proxy(function(){this.remove_()},this));var r=e(window).width();this.updateFunc=e.proxy(function(){if(r&&r!==e(window).width()){r=e(window).width();this.update_()}},this);t.autoResize&&e(window).on("orientationchange debouncedresize",this.updateFunc);this.$graphContainer.on("GET_DATA_RANGE",e.proxy(function(t,i){e.proxy(this.getData(e.proxy(function(t){i(n.Range.getDataRange(t,this.range.isTimeline))},this),this));return e(this.$graphContainer)},this));this.$graphContainer.on("GET_LABEL",e.proxy(function(t,i,n){e.proxy(this.getData(e.proxy(function(t){n(this.getDataLabelByIndex(i,t))},this),this));return e(this.$graphContainer)},this));this.$graphContainer.on("APPEND_TO",e.proxy(function(t,i){this.$graphContainer.appendTo(i);this.graphData[this.range.unit].done(e.proxy(function(t){var i;i=this.range.isTimeline?e.grep(t,e.proxy(function(t){return this.range.start<=t.timestamp&&t.timestamp<=this.range.end},this)):t.slice(this.range.min,this.range.max+1);this.draw_(i)},this));return e(this.$graphContainer)},this));return this.$graphContainer};n.Graph.prototype.getData=function(t){n.Data.getData(this.origData_,this.$graphContainer,t,this)};n.Graph.prototype.getDataLabelByIndex=function(t,i){var n=this.config.dataLabel||"x";return e.map(t,function(t){return i[t][n]})};n.Graph.prototype.getTotalCount_=function(t,i){var n=0,r="y"+(i||"");e.each(t,function(t,e){n+=parseInt(e[r]||e.value||0,10)});return n};n.Graph.prototype.getDelta_=function(t,e){var i,n,r,a,s=t.length;a="y"+(e||"");i=t[s-1];n=t[s-2];r=n&&i&&n[a]?i[a]-n[a]:i[a];return void 0===r?"":r};n.Graph.presetColors=function(){return["#6AAC2B","#FFBE00","#CF6DD3","#8F2CFF","#2D85FF","#5584D4","#5ED2B8","#9CCF41","#F87085","#2C8087","#8EEC6A","#FFE700","#FF5E19","#FF4040","#976BD6","#503D99","#395595"]};n.Graph.getChartColors=function(t,e){var i={reverse:function(t){return t.reverse()},shuffle:function(t){var e,i,n,r;n=t.length;for(e=0;n>e;e++){i=Math.floor(Math.random()*n);r=t[e];t[e]=t[i];t[i]=r}return t},def:function(t){return t}};return i[e||"def"](t||n.Graph.presetColors())};n.Graph.cachedChartColors={};n.Graph.getCachedChartColors=function(t,e,i){return n.Graph.cachedChartColors[t]=n.Graph.cachedChartColors[t]||n.Graph.getChartColors(e,i)};n.Graph.prototype.draw_=function(t){var i=this.config.type.split("."),r=i[0],a=i[1],s=this.config;if(s.label)if(this.labelTemplate)this.generateLabel(this.labelTemplate);else if(s.label.template){var o=s.label.template;if(window.require&&"function"==typeof require){var h=s.label.type;require([h+"!"+s.staticPath+o],e.proxy(function(t){this.labelTemplate=t;this.generateLabel(t)},this))}else{var l=e.get(s.staticPath+o,"text");n.Data.getData(l,this.$graphContainer,e.proxy(function(t){this.labelTemplate=t;this.generateLabel(t)},this))}}else{this.labelTemplate='<span class="graph-label-label"></span>';this.generateLabel(this.labelTemplate)}if(s.fallback&&s.fallback.test&&!n.Graph.test[s.fallback.test]){i=s.fallback.type.split(".");r=i[0];a=i[1];s=e.extend(s,s.fallback)}s.chartColors&&"string"==typeof s.chartColors&&(s.chartColors=s.chartColors.split(","));this.graphObject=n.Graph[r][a](t,s,this.range,this.$graphContainer)};n.Graph.test={};n.Graph.test.canvas=function(){var t=document.createElement("canvas");return t.getContext&&t.getContext("2d")};n.Graph.test.svg=function(){var t={svg:"http://www.w3.org/2000/svg"};return!!document.createElementNS&&!!document.createElementNS(t.svg,"svg").createSVGRect};n.Graph.test.vml=function(){var t,e=n.Graph.test.svg();if(!e){var i=document.body.appendChild(document.createElement("div"));i.innerHTML='<v:shape id="vml_flag1" adj="1" />';var r=i.firstChild;r.style.behavior="url(#default#VML)";t=r?"object"==typeof r.adj:!0;i.parentNode.removeChild(i)}return e||t};n.Graph.prototype.generateLabel=function(t){var i,r=this.config.label.template&&this.config.label.data?this.config.label.data:{},a=this.config.label.yLength||this.config.yLength,s=e.proxy(function(){this.labels=new n.Graph.Labels(this.$graphContainer,a,t);this.getData(e.proxy(function(t){for(var e=0;a>e;e++){this.config.label.hideTotalCount||this.labels.getTotalObject(e).createTotalCount(this.getTotalCount_(t,e));!this.config.label.hideDeltaCount&&this.range.isTimeline&&this.labels.getTotalObject(e).createDeltaCount(this.getDelta_(t,e))}},this))},this);if(r&&"string"==typeof r)i=e.getJSON(this.config.staticPath+r);else{i=e.Deferred();i.resolve(r)}i.done(function(e){if(t&&"function"==typeof t){t=t(e);s()}else if(_){t=_.template(t,e);s()}else{t=t;s()}})};n.Graph.prototype.update_=function(t,i){var r=this;t=t||[];this.graphObject&&this.graphObject.remove&&this.graphObject.remove();this.labels&&this.labels.remove();this.range=n.Range.generate({start:t[0]||this.range.start,end:t[1]||this.range.end,length:null,maxLength:this.range.maxLength,unit:i||this.range.unit,dataType:this.range.dataType,autoSized:this.range.autoSized});this.graphData[this.range.unit].done(e.proxy(function(t){var i;i=r.range.isTimeline?e.grep(t,e.proxy(function(t){return this.range.min<=t.timestamp&&t.timestamp<=this.range.max},this)):t.slice(this.range.min,this.range.max+1);this.draw_(i)},this))};n.Graph.prototype.remove_=function(){this.config.autoResize&&e(window).off("orientationchange debouncedresize",this.updateFunc);this.graphObject&&this.graphObject.remove&&this.graphObject.remove();this.labels&&this.labels.remove();this.$graphContainer.remove()};n.Graph.prototype.generateGraphData=function(t){var i,r,a,s,o,h,l,u=this.range,c=u.start,p=u.end,d=u.unit,f=u.length,g=[],v=this.config.yLength||1;if(this.range.isTimeline){var m=n.Range.getDataRange(t,this.range.isTimeline);c=new Date(Math.min(this.range.min,m.min));p=new Date(Math.max(this.range.max,m.max));f=n.Range.getLength(c,p,d);o=n.Data.filterData(t,m.max,m.min,d,v);for(i=0;f>i;i++){a=n.Range.getNextDate(c,p,i,d);if(!a)break;s=n.Date.createId(a,d);h={timestamp:a.valueOf(),x:n.Date.createXLabel(a,d)};for(r=0;v>r;r++){l="y"+(r||"");h[l]=o[s]?o[s][l]||0:0}g.push(h)}}else g=t;"morris.donut"===this.config.type&&e.each(g,function(t,i){e.extend(i,{label:i.xLabel||i.x,value:i.y})});return g};n.Graph.Labels=function(t,i,r){var a,s;this.$labelContainer=e('<div class = "graph-labels"></div>');r&&e('<div class="graph-label"></div>').html(r).prependTo(this.$labelContainer);this.totals={};for(a=0;i>a;a++){s="y"+(a||"");this.totals[s]=new n.Graph.Labels.Total(this.$labelContainer,a)}this.$labelContainer.appendTo(t)};n.Graph.Labels.prototype.remove=function(){this.$labelContainer.remove()};n.Graph.Labels.prototype.getTotalObject=function(t){return this.totals["y"+(t||"")]};n.Graph.Labels.Total=function(t,e){this.index=e;this.$totalContainer=i('<div class = "graph-total"></div>').appendTo(t)};n.Graph.Labels.Total.prototype.createTotalCount=function(t){i('<span class="graph-total-count graph-total-count-y"'+(this.index||"")+">"+t+"</span> ").appendTo(this.$totalContainer)};n.Graph.Labels.Total.prototype.createDeltaCount=function(t){var e=t?0>t?"minus ":"plus ":"zero ";i('<span class="graph-delta graph-delta-y"'+(this.index||"")+'><span class="'+e+'">('+t+")</span></span>").appendTo(this.$totalContainer)};n.Graph.css={};n.Graph.css.Base=function(t,i){this.len=t.length;this.$graphEl=e('<div id="'+i.id+'" class="css-graph">')};n.Graph.css.Base.prototype.remove=function(){this.$graphEl.remove()};n.Graph.css.Base.prototype.horizontalBar=function(t,i,r,a){i.width&&this.$graphEl.css({width:i.width,"max-width":"100%",margin:"0 auto"});for(var s,o,h,l,u,c,p=i.barColor||n.Graph.getCachedChartColors(i.id,null,i.chartColorsMethod)[1],d=i.barBackgroundColor||"#f0f0f0",f=i.dateColor||"#999999",g=i.labelColor||"#999999",v=parseInt(i.barWidth,10)||30,m=parseInt(i.barInterval,10)||5,y=parseInt(i.labelSize,10)||.45*v,x=function(){return e('<div class="css-graph-container"><div class="css-graph-date"></div><div class="css-graph-bar-container" style="height:'+v+"px; margin-bottom:"+m+'px"><div class="css-graph-bar"></div><div class="css-graph-bar-background"><div class="css-graph-bar-count"></div></div></div>')},b=_.map(t,function(t){return parseInt(t.y,10)}),w=_.map(t,function(t){return""+parseInt(t.x.substr(t.x.lastIndexOf("-")+1),10)}),C=Math.max.apply(null,b)||1,D=i.yLabel||b,T=this.len;T>0;){T-=1;s=Math.floor(100*(b[T]/C))-15;o=x();h=o.find(".css-graph-bar-background");h.css({"background-color":d});if(i.showDate){c=o.find(".css-graph-date");c.text(w[T]).css({color:f,"font-size":y+"px","line-height":v+"px"});o.find(".css-graph-bar-container").css({"margin-left":v+"px"})}l=o.find(".css-graph-bar");l.css({width:s+"%","background-color":p});u=o.find(".css-graph-bar-count");u.text(D[T]).css({color:g,"font-size":y+"px","line-height":v+"px"});o.appendTo(this.$graphEl)}this.$graphEl.appendTo(a)};n.Graph.css.Base.prototype.ratioHorizontalBar=function(t,i,r,a){var s,o,h,l,u,c,p,d,f,g,v,m,y=i.yLength,x=parseInt(i.barWidth,10)||30,_=parseInt(i.barInterval,10)||5,b=parseInt(i.labelSize,10)||.45*x,w=i.dateColor||"#999999",C=i.barColors||n.Graph.getCachedChartColors(i.id,null,i.chartColorsMethod),D=i.labelColors,T=i.labelClasses;for(s=0;this.len>s;s++){h=t[s];l=[];u=0;m=0;for(o=0;y>o;o++){l.push(h["y"+(o||"")]);u+=parseInt(h["y"+(o||"")],10)}c=e('<div class="css-graph-container"></div>').appendTo(this.$graphEl);if(i.showDate&&h.x){f=""+parseInt(h.x.substr(h.x.lastIndexOf("-")+1),10);g=e('<div class="css-graph-date" style="color:'+w+";font-size: "+b+"px; line-height:"+x+'px">'+f+"</div>").appendTo(c)}p=e('<div class="css-graph-bar-container" style="height:'+x+"px; margin-bottom:"+_+'px"></div>').appendTo(c);i.showDate&&p.css({"margin-left":x+"px"});for(o=0;y>o;o++){v=Math.floor(1e3*(l[o]/u))/10;if(v){y===o&&(v=100-m);m+=v;d=e('<div class="css-graph-y css-graph-y'+(o||"")+'" data-count="'+l[o]+'" style="line-height:'+x+"px; font-size:"+b+'px"></div>');d.css({width:v+"%","background-color":C[o]});i.showCount&&d.text(l[o]);T&&T[o]&&d.addClass(T[o]);D&&D[o]&&d.css({color:D[o]});d.appendTo(p)}}p.appendTo(c)}this.$graphEl.appendTo(a)};n.Graph.css.horizontalBar=n.Graph.css.ratioHorizontalBar=function(t,e,i,r){var a=new n.Graph.css.Base(t,e,i,r),s=e.type.slice(e.type.lastIndexOf(".")+1);a[s](t,e,i,r);return a};n.Graph.easel={};n.Graph.easel.Base=function(t,i,n,r){this.data=t;this.config=i;this.range=n;this.$container=r;if(createjs||"function"!=typeof window.require){var a=parseInt(i.width||r.width(),10);a?this.buildCanvas(createjs):setTimeout(e.proxy(function(){this.buildCanvas(createjs)},this),100)}else require(["easeljs"],function(t){this.buildCanvas(t)})};n.Graph.easel.Base.prototype.buildCanvas=function(t){this.width=parseInt(this.config.width||this.$container.width(),10)||300;this.height=parseInt(this.config.height||this.$container.height(),10)||300;this.$canvas=e('<canvas id="'+this.config.id+'" class="graph-canvas" width="'+this.width+'" height="'+this.height+'">').appendTo(this.$container);this.canvas=this.$canvas.get(0);this.canvas.getContext("2d");this.stage=this.graph=new t.Stage(this.canvas);this.stage.update();var i=this.config.type.split(".")[1];this[i](this.data,this.config)};n.Graph.easel.Base.prototype.remove=function(){this.$canvas.remove()};n.Graph.easel.Base.prototype.bar=function(t,i){for(var r,a,s,o,h,l=t.length,u=i.chartColorsAlpha?i.chartColorsAlpha[0]:1,c=i.chartColors||n.Graph.getCachedChartColors(i.id,null,i.chartColorsMethod),p=this.convertColor(c[0],u),d=parseInt(i.barMargin,10)||10,f=Math.floor(this.width/l),g=f-d,v=Math.floor((this.width-f*l)/2)+d/2,m=e.map(t,function(t){return parseInt(t.y,10)}),y=Math.max.apply(null,m)||1,x=0;l>x;x++){r=new createjs.Shape;a=r.graphics;s=x*f+v;h=Math.floor(m[x]/y*this.height);o=this.height-h;a.beginFill(p).drawRect(s,o,g,h);this.stage.addChild(r)}this.stage.update()};n.Graph.easel.Base.prototype.motionLine=function(t,i){for(var r,a=t.length,s=parseInt(i.lineWidth,10)||8,o=i.yLength||1,h=i.lineColors||i.chartColors||n.Graph.getCachedChartColors(i.id,null,i.chartColorsMethod),l=this.config.chartColorsAlpha||[null],u=s/2,c=2*(a-1),p=Math.floor(this.width/a)/2,d=(this.width-p*c)/2,f=this.height,g=this.height-s,v=[],m=function(t){return parseInt(t["y"+(y||"")],10)},y=0;o>y;y++){r=e.map(t,m);v.push(r)}var x=[];e.each(v,function(t,e){x=x.concat(e)});var _=Math.max.apply(null,x)||1,b=[],w=function(t){var i=[];e.each(t,function(e,n){if(e>0){var r=t[e-1],a=r+Math.floor((n-r)/2);a=Math.floor(a/_*g)+u;n=Math.floor(n/_*g)+u;i=i.concat([a,n])}else{n=Math.floor(n/_*g)+u;i.push(n)}});return i};e.each(v,function(t,e){b.push(w(e))});var C,D,T=[],L=[],k=d;for(y=0;o>y;y++){C=this.convertColor(h[y],l[y]);T[y]=new createjs.Shape;L[y]=T[y].graphics;D=f-b[y][0];L[y].setStrokeStyle(s).beginStroke(C).moveTo(k,D);this.stage.addChild(T[y])}var M=this.stage,E=function(t){c-=1;0===c&&createjs.Ticker.removeEventListener("tick",E);k+=p;for(var e,i=0;o>i;i++){e=b[i];D=f-e[e.length-c-1];L[i].lineTo(k,D)}M.update(t)};createjs.Ticker.useRAF=!0;createjs.Ticker.setFPS(30);createjs.Ticker.addEventListener("tick",E)};n.Graph.easel.Base.prototype.convertColor=function(t,e){if(-1!==t.indexOf("#")){var i=parseInt(t.substr(1,2),16),n=parseInt(t.substr(3,2),16),r=parseInt(t.substr(5,2),16);t=e?"rgba("+[i,n,r,e].join(",")+")":"rgb("+[i,n,r].join(",")+")"}else-1!==t.indexOf("rgb")&&(t=4>t.split(",").length?"rgb("+t+")":"rgba("+t+")");return t};n.Graph.easel.Base.prototype.mix=function(t,i){var r=0,a=function(t,i){t=t||1;var n=e.map(i,function(e){for(var i,n,a={x:e.x},s=0;t>s;s++){i="y"+(s||"");n="y"+(r+s||"");a[i]=e[n]}return a});r+=t;return n},s=i.chartColors||n.Graph.getCachedChartColors(i.id,null,i.chartColorsMethod);e.each(i.mix,e.proxy(function(n,o){var h={chartColors:s.slice(r,r+o.yLength)},l=a(o.yLength,t);o=e.extend({},i,h,o);this[o.type](l,o)},this))};n.Graph.easel.bar=n.Graph.easel.motionLine=n.Graph.easel.mix=function(t,e,i,r){if(n.Graph.test.canvas()){var a=new n.Graph.easel.Base(t,e,i,r);return a}console.warn("EaselJS graph requires for HTML5 Canvas capability");r.trigger("REMOVE")};n.Graph.morris={};n.Graph.morris.Base=function(t,i,n,r){if(Morris||"function"!=typeof window.require){var a=i.width||r.width();a?this.build_(Morris,t,i,n,r):setTimeout(e.proxy(function(){this.build_(Morris,t,i,n,r)},this),100)}else require(["morris"],function(e){this.build_(e,t,i,n,r)})};n.Graph.morris.Base.prototype.build_=function(t,i,r,a,s){var o,h,l,u=r.type.split(".")[1],c=r.yLength,p=r.width||s.width()||300,d=r.height||s.height()||300;this.$graphEl=e('<div id="'+r.id+'" class="graph-element"></div>').css({height:d+"px",width:p+"px"}).prependTo(s);r=e.extend({},r,{element:r.id,data:i,xkey:"x",labels:this.getYLabels_(c,r.labels),ykeys:this.getYKeys_(c),ymax:this.getYMax_(i,u,c),ymin:r.ymin||0,lineWidth:parseInt(r.lineWidth,10)||6,pointSize:parseInt(r.pointSize,10)||6,smooth:r.smooth||!1});r.barColors=r.barColors||this.getChartColors(r);r.colors=r.colors||this.getChartColors(r);r.lineColors=r.lineColors||this.getChartColors(r);r.numLines=parseInt(r.numLines,10)||this.getNumLines_(r.ymax,d);r.pointStrokeColors=r.pointStrokeColors?r.pointStrokeColors.split(/,/):[];if(!r.pointStrokeColors.length)for(o=0;c>o;o++)r.pointStrokeColors.push("none");h={element:null,data:null,xkey:"x",labels:[],ykeys:[],dateFormat:null,axes:!0,grid:!0,gridLineColor:"#aaa",gridStrokeWidth:.5,gridTextColor:"#888",gridTextSize:12,hideHover:!1,yLabelFormat:null,numLines:5,padding:25,parseTime:!0,postUnits:"",preUnits:"",ymax:"auto",ymin:"auto 0",goals:[],goalStrokeWidth:1,goalLineColors:["#666633","#999966","#cc6666","#663333"],events:[],eventStrokeWidth:1,eventLineColors:["#005a04","#ccffbb","#3a5f0b","#005502"],lineWidth:3,pointSize:4,lineColors:["#0b62a4","#7A92A3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],pointWidths:[1],pointStrokeColors:["#ffffff"],pointFillColors:[],smooth:!0,xLabels:"auto",xLabelFormat:null,xLabelMargin:50,continuousLine:!0,barSizeRatio:.75,barGap:3,barColors:["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],colors:["#0B62A4","#3980B5","#679DC6","#95BBD7","#B0CCE1","#095791","#095085","#083E67","#052C48","#042135"],backgroundColor:"#FFFFFF",labelColor:"#000000",formatter:t.commas};l={};e.each(r,function(t,e){void 0!==h[t]&&(l[t]=e)});n.Graph.test.svg||(l.smooth=!0);if("donut"===u){var f=this.getTotalCount_(i,o);l.formatter=function(t){return t+"("+Math.ceil(1e4*(t/f))/100+"%)"}}var g={bar:t.Bar,line:t.Line,donut:t.Donut,area:t.Area}[u];this.graph=new g(l)};n.Graph.morris.Base.prototype.getYMax_=function(t,i,n){var r,a,s,o,h;if("area"!==i){s=[];e.each(t,function(t,e){for(r=0;n>r;r++){h="y"+(r||"");s.push(parseInt(e[h],10))}});a=Math.max.apply(null,s)}else a=Math.max.apply(null,e.map(t,function(t){o=0;for(r=0;n>r;r++){h="y"+(r||"");o+=parseInt(t[h],10)}return o}));a||(a=1);0!==a%2&&(a+=1);return a};n.Graph.morris.Base.prototype.getChartColors=function(t){this.chartColors||(this.chartColors=t.chartColors||n.Graph.getCachedChartColors(t.id,null,t.chartColorsMethod));return this.chartColors};n.Graph.morris.Base.prototype.getYKeys_=function(t){var e,i=[];for(e=0;t>e;e++)i.push("y"+(e||""));return i};n.Graph.morris.Base.prototype.getYLabels_=function(t,e){var i,n=[];e=e?e.split(/,/):[];for(i=0;t>i;i++)n.push(e[i]||"Count");return n};n.Graph.morris.Base.prototype.getNumLines_=function(t,e){var i;i=t>=18?9:2===t?3:t/2+1;i=Math.min(i||1,Math.floor(e/56));return i};n.Graph.morris.Base.prototype.getTotalCount_=function(t,i){var n=0,r="y"+(i||"");e.each(t,function(t,e){n+=e[r]||e.value||0});return n};n.Graph.morris.Base.prototype.remove=function(){this.$graphEl.remove()};n.Graph.morris.bar=n.Graph.morris.line=n.Graph.morris.donut=n.Graph.morris.area=function(t,e,i,r){if(n.Graph.test.vml()){var a=new n.Graph.morris.Base(t,e,i,r);return a}console.warn("Morris graph requires for SVG/VML capability");r.trigger("REMOVE")};n.Slider=function(t,i,r,a,s){if(!e.ui||!e.ui.slider)throw"ChartAPI.Slider requied jQuery UI Slider";var o=this;this.id="slider-"+(new Date).valueOf()+Math.floor(100*Math.random());this.config=t;this.range=n.Range.generate(i);this.$dataRangeTarget=r;this.$sliderContainer=e('<div id="'+this.id+'-container" class="slider-container"></div>');this.eventTargetList={update:this.initEventTarget(),amount:this.initEventTarget()};e.each(a,function(t,e){o.eventTargetList.update.add(e)});e.each(s,function(t,e){o.eventTargetList.amount.add(e)});this.$sliderContainer.on("APPEND_TO",function(t,i){o.$container=i;o.draw_(i);return e(this)});this.$sliderContainer.on("BUILD_SLIDER",function(){o.$dataRangeTarget.trigger("GET_DATA_RANGE",function(t){o.buildSlider(t.min,t.max)});return e(this)});this.$sliderContainer.on("SET_DATA_RANGE",function(t,i){o.$dataRangeTarget=i;return e(this)});this.$sliderContainer.on("ADD_EVENT_LIST",function(t,i,n){n=e.isArray(n)?n:[n];e.each(n,function(t,e){o.eventTargetList[i].add(e)});return e(this)});this.$sliderContainer.on("REMOVE_EVENT_LIST",function(t,i,n){n=e.isArray(n)?n:[n];e.each(n,function(t,e){o.eventTargetList[i].remove(e)});return e(this)});this.$sliderContainer.on("ERASE",function(){o.erase_();return e(this)});this.$sliderContainer.on("REDRAW",function(){var t=e(this);t.trigger("BUILD_SLIDER").trigger("APPEND_TO",[o.$container]);return e(this)});this.$sliderContainer.on("UPDATE",function(t,i){o.$slider("values",i);o.updateSliderAmount(i);return e(this)});return this.$sliderContainer};n.Slider.prototype.initEventTarget=function(){var t=[];return{add:function(e){t.push(e)},remove:function(i){t=e.grep(t,function(t){return t!==i})},get:function(){return t}}};n.Slider.prototype.buildSlider=function(t,i,n){var r=this;n=n||[this.range.min,this.range.max];if(this.$slider){this.$slider.destroy();this.$slider.remove()}this.$slider=e('<div class="slider"></div>').slider({range:!0,min:t,max:i,values:n,slide:function(t,e){r.updateSliderAmount(e.values,e)},stop:function(t,e){r.updateGraphAndList(e.values)}}).appendTo(r.$sliderContainer);if(!this.config.hideSliderAmount){this.$amount=e('<div class="amount"></div>');this.config.appendSliderAmountBottom?this.$amount.appendTo(this.$sliderContainer):this.$amount.prependTo(this.$sliderContainer);this.updateSliderAmount(n)}};n.Slider.prototype.draw_=function(t){this.$sliderContainer.appendTo(t)};n.Slider.prototype.erase_=function(){this.$slider&&this.$slider.destroy();this.$sliderContainer.html("")};n.Slider.prototype.updateSliderAmount=function(t,i){var r,a,s,o,h=this.range.maxLength,l=this.$amount;if(this.range.isTimeline){r=n.Date.parse(t[0]);a=n.Date.parse(t[1]);s=this.range.unit;o=n.Range.getLength(r,a,s);if(i&&o>h)if(i.value===i.values[0]){a=n.Date.calcDate(r,h,s,!1);this.$slider.slider("values",1,a.valueOf())}else{r=n.Date.calcDate(a,h,s,!0);this.$slider.slider("values",0,r.valueOf())}l&&l.text([n.Date.createXLabel(r,s),n.Date.createXLabel(a,s)].join(" - "))}else{r=t[0];a=t[1];if(a-r>h)if(i.value===i.values[0]){a=h-r;this.$slider.slider("values",1,a)}else{r=a-h;this.$slider.slider("values",0,r)}l&&e.each(this.eventTargetList.amount.get(),function(t,e){e.trigger("GET_LABEL",[[r,a],function(t){l.text([t[0],t[1]].join(" - "))}])})}};n.Slider.prototype.updateGraphAndList=function(t,i){e.each(this.eventTargetList.update.get(),function(e,n){n.trigger("UPDATE",[t,i])})};n.Slider.prototype.update_=function(t,e){this.$slider.slider("values",t,e)};n.List=function(t,i){this.id="list-"+(new Date).valueOf()+Math.floor(100*Math.random());this.config=t;this.config.staticPath=this.config.staticPath||"";if(this.config.data&&"string"==typeof this.config.data)this.origData_=e.getJSON(this.config.staticPath+this.config.data);else{this.origData_=e.Deferred();this.origData_.resolve(this.config.data)}if(this.config.template){if(window.require&&"function"==typeof require){var r=this.config.type||"text";this.template_=e.Deferred();require([r+"!"+this.config.staticPath+this.config.template],e.proxy(function(t){this.template_.resolve(t)},this))}else this.template_=e.get(this.config.staticPath+this.config.template,"text");this.range=n.Range.generate(i);this.$listContainer=e('<div id="'+this.id+'-container" class="list-container"></div>');this.$listContainer.on("UPDATE",e.proxy(function(t,e){this.update_(e)},this));this.$listContainer.on("GET_DATA_RANGE",e.proxy(function(t,i){this.getData(e.proxy(function(t){i(n.Range.getDataRange(t,this.range.isTimeline))},this));return this.$listContainer},this));this.$listContainer.on("GET_LABEL",e.proxy(function(t,i,n){this.getData(e.proxy(function(t){n(this.getDataLabelByIndex(i,t))},this));return this.$listContainer},this));this.$listContainer.on("APPEND_TO",e.proxy(function(t,i){this.$listContainer.appendTo(i);this.getData(e.proxy(function(t){this.draw_(t)},this));return this.$listContainer},this));return this.$listContainer}};n.List.prototype.getData=function(t){this.config.data?n.Data.getData(this.origData_,this.$listContainer,t,this):t()};n.List.prototype.getTemplate=function(t){n.Data.getData(this.template_,this.$listContainer,t,this)};n.List.prototype.draw_=function(t){var e=this;this.getTemplate(function(i){t=e.createListData(t);e.$listContainer.html(_.template(i,t))})};n.List.prototype.getDataLabelByIndex=function(t,i){var n=this.config.dataLabel||"x";return e.map(t,function(t){return i[t][n]})};n.List.prototype.createListData=function(t){var e="";t&&(e=this.range.isTimeline?n.Data.filterData(t,this.range.max,this.range.min,this.range.unit,1,!0):t.slice(this.range.min,this.range.max+1));return{data:e}};n.List.prototype.update_=function(t,e){var i=this;t=t||[];e=e||this.range.unit;this.range=n.Range.generate({start:t[0]||this.range.start,end:t[1]||this.range.end,length:null,maxLength:this.range.maxLength,unit:e,dataType:this.range.dataType});this.getData(function(t){i.draw_(t)})};n.Build=function(t){var i;if("string"==typeof t&&/\.json$/.test(t)){i=e('<div class="mtchart-container">');n.Data.getData(e.getJSON(t),null,function(t){t.$container=i;n.Build_(t).trigger("APPEND")})}else i=n.Build_(t).trigger("APPEND");return i};n.Build_=function(t){var i,r,a,s,o,h,l;i=t.$container||e('<div class="mtchart-container">');h=[];if(t.graph){r=new n.Graph(t.graph,t.range);h.push(r)}if(t.list){s=new n.List(t.list,t.range);t.list.data&&h.push(s)}if(t.graph&&"donut"!==t.graph.type){o=r;l=[r]}else{o=s;l=[s]}var u=function(){var t=window.navigator?window.navigator.userAgent:"";return/android|iphone|ipod|ipad/i.test(t)};!t.slider||!t.slider.force&&u()||(a=new n.Slider(t.slider,t.range,o,h,l));i.on("APPEND",function(){r&&r.trigger("APPEND_TO",[i]);a&&a.trigger("BUILD_SLIDER").trigger("APPEND_TO",[i]);s&&s.trigger("APPEND_TO",[i])});i.on("GET_CONTAINER",function(t,e,i){i({graph:r,slider:a,list:s}[e])});return i};return n})(this,jQuery);return MT.ChartAPI});