(function(a){a.each(["plugin","core"],function(){tinymce.ScriptLoader.add(tinymce.PluginManager.urls.mt+"/langs/"+this+".js")});tinymce.Editor.prototype.addMTButton=function(e,f){var d=this;var g={};var c=f.onclickFunctions;var b=f.onPostRender;if(c){f.onclick=function(){var i=d.mtEditorStatus.mode;var h=c[i];if(typeof(h)=="string"){d.mtProxies[i].execCommand(h)}else{h.apply(d,arguments)}if(i=="source"){d.fire("MTSourceButtonClick",d,d.controlManager)}};for(k in c){g[k]=1}}else{g={wysiwyg:1,source:1}}if(!f.isSupported){f.isSupported=function(j,i){if(!g[j]){return false}if(c&&j=="source"){var h=c[j];if(typeof(h)=="string"){return d.mtProxies.source.isSupported(h,i)}else{return true}}else{return true}}}f.onPostRender=function(){f._ctrl=this;if(b){b.apply(this,arguments)}};if(typeof(d.mtButtons)=="undefined"){d.mtButtons={}}d.mtButtons[e]=f;return d.addButton(e,f)};tinymce.create("tinymce.plugins.MovableType",{buttonSettings:"",_initButtonSettings:function(b){var e=this;e.buttonIDs={};var d={source:{},wysiwyg:{}};var c=1;a.each(["common","source","wysiwyg"],function(h,f){var l="plugin_mt_"+f+"_buttons";for(var g=1;b.settings[l+g];g++){e.buttonSettings+=(e.buttonSettings?",":"")+b.settings[l+g];b.settings["toolbar"+c]=b.settings[l+g];if(f=="common"){d.source[c-1]=d.wysiwyg[c-1]=1}else{d[f][c-1]=1}c++}});return d},_setupIframeStatus:function(b){b.on("PostRender",function(){var h=a(window);var d=a(b.getContainer());var g=d.find("iframe");var f=a(b.getWin());var c=".tinymce_mt_iframe_status_"+b.id;f.focus(function(){g.addClass("state-focus")}).blur(function(){g.removeClass("state-focus")});function e(){f.bind("mousemove"+c,function(){f.unbind("mousemove"+c);g.addClass("state-hover");h.bind("mousemove"+c,function(){h.unbind("mousemove"+c);g.removeClass("state-hover");e()})})}e()})},init:function(h,g){var e=this;var o=h.id;var c=o.length;var q=a("#blog-id").val()||0;var d={};var n=[];var p=null;var u=null;var f={};var t=this._initButtonSettings(h);var j={};h.mtProxies=d;h.mtEditorStatus={mode:"wysiwyg",format:"richtext"};function r(x,w){var v=x+"-"+w;if(!f[v]){f[v]={};a.each(h.mtButtons,function(y,z){if(z.isSupported(x,w)){f[v][y]=z}})}return f[v]}function b(){var v=h.mtEditorStatus;a.each(n,function(z,y){p.find(".mce-i-"+y).css({display:""}).removeClass("mce_mt_button_hidden");if(h.mtButtons[y]["_ctrl"]){h.mtButtons[y]["_ctrl"].disabled(false)}});n=[];var w=r(v.mode,v.format);function x(y){if(!w[y]){p.find(".mce-i-"+y).css({display:"none"}).addClass("mce_mt_button_hidden");n.push(y)}}if(v.mode=="source"){d.source.setFormat(v.format)}a.each(h.mtButtons,function(y,z){x(y)});p.find(".mce-container.mce-toolbar").each(function(y){if(t[v.mode][y]){a(this).show()}else{a(this).hide()}})}h.on("PostRender",function(){p=a(h.getContainer());p.find(".mce-widget.mce-btn.mce-btn-small button").each(function(){if(a(this).find("i").length===0){a(this).addClass("mce-mt-textbutton")}});p.find(".mce-btn-group:not(:last-child)").each(function(){a(this).after('<span class="mce-mt-separator"></span>')})});function s(w,v){createSessionHistoryFallback(location.href);a.fn.mtDialog.open(ScriptURI+"?__mode="+w+"&amp;"+v)}function m(y,w){function v(A,C,B,D,z){if(C=="mceInsertContent"){d.source.editor.insertContent(D);z.terminate=true}}function x(){h.on("BeforeExecCommand",v);y.window.TemplateDialog.insert();h.on("BeforeExecCommand",v)}setTimeout(function(){y["$contents"].find("form").attr("onsubmit","").submit(x)},0)}function l(w,v){a.each(h.mtButtons,function(x,y){var z;if(y.onclickFunctions&&(z=y.onclickFunctions["source"])&&(typeof(z)=="string")&&(e.buttonSettings.indexOf(x)!=-1)){j[x]=z}})}function i(){a.each(j,function(v,w){h.mtButtons[v]["_ctrl"].active(h.mtProxies.source.isStateActive(w))})}h.on("Init",function(){p=a(h.getContainer());b();l()});h.on("PreInit",function(){var w="data-mce-mt-",v=new RegExp("^"+w),x='javascript:void("mce-mt-event-placeholer");return false';h.parser.addAttributeFilter([/^on|action/],function(y,z){var A,C,B=w+z;for(A=0;A<y.length;A++){C=y[A];C.attr(B,C.attr(z));C.attr(z,x)}});h.serializer.addAttributeFilter([v],function(y,B){var A,C,D,E,z=B.substring(w.length);for(A=0;A<y.length;A++){C=y[A];E=C.attr(z);D=C.attr(B);if(E===x){if(!(D&&D.length>0)){D=null}C.attr(z,D)}C.attr(B,null)}});h.parser.addNodeFilter("#comment,#cdata",function(y,z){var A,B;for(A=0;A<y.length;A++){B=y[A];B.value=escape(B.value)}});h.serializer.addNodeFilter("#comment",function(y,z){var A,B;for(A=0;A<y.length;A++){B=y[A];B.value=unescape(B.value);if(B.value.indexOf("[CDATA[")===0){B.name="#cdata";B.type=4;B.value=B.value.replace(/^\[CDATA\[|\]\]$/g,"")}}})});if(h.settings.plugin_mt_tainted_input&&tinymce.isIE){h.on("PreInit",function(){var x="data-mce-mtie-",y="-mt-placeholder:auto;",w="mce-mt-",v=new RegExp("^"+w);h.parser.addNodeFilter("link",function(z,A){var B,C;for(B=0;B<z.length;B++){C=z[B];a.each(["type","rel"],function(E,D){var F=C.attr(D);if(F){C.attr(D,w+F)}})}});h.parser.addNodeFilter("style",function(z,A){var B,C;for(B=0;B<z.length;B++){C=z[B];C.attr("type",w+(C.attr("type")||"text/css"))}});h.serializer.addNodeFilter("link,style",function(z,A){var B,C,D;for(B=0;B<z.length;B++){C=z[B];a.each(["type","rel"],function(F,E){var G=C.attr(E);if(G){C.attr(E,G.replace(v,""))}})}});h.parser.addAttributeFilter("style",function(z,A){var B,D,C=x+A;for(B=0;B<z.length;B++){D=z[B];D.attr(C,D.attr(A));D.attr(A,y)}});h.serializer.addAttributeFilter(x+"style",function(z,C){var B,D,E,F,A=C.substring(x.length);for(B=0;B<z.length;B++){D=z[B];F=D.attr(A);E=D.attr(C);if(F===y){if(!(E&&E.length>0)){E=null}D.attr(A,E)}D.attr(C,null)}})})}this._setupIframeStatus(h);h.addCommand("mtGetStatus",function(){return h.mtEditorStatus});h.addCommand("mtSetStatus",function(v){a.extend(h.mtEditorStatus,v);b()});h.addCommand("mtGetProxies",function(){return d});h.addCommand("mtSetProxies",function(v){a.extend(d,v)});h.addCommand("mtRestoreBookmark",function(v){if(!v){v=u}if(v){h.selection.moveToBookmark(u)}});h.addCommand("mtSaveBookmark",function(){return u=h.selection.getBookmark()});a(window).bind("dialogDisposed",function(){if(u){h.selection.moveToBookmark(u)}u=null});h.addButton("mt_insert_html",{title:"mt_insert_html",onclick:function(){h.windowManager.open({title:"mt_insert_html",body:[{name:"source",type:"textbox",multiline:true,rows:14,autofocus:true,minWidth:450,minHeight:220}],onSubmit:function(x){var w=x.data,v=w.source;h.insertContent(v)}})}});h.addMTButton("mt_insert_image",{title:"mt_insert_image",onclick:function(){h.execCommand("mtSaveBookmark");s("dialog_list_asset","_type=asset&amp;edit_field="+o+"&amp;blog_id="+q+"&amp;dialog_view=1&amp;filter=class&amp;filter_val=image")}});h.addMTButton("mt_insert_file",{title:"mt_insert_file",onclick:function(){h.execCommand("mtSaveBookmark");s("dialog_list_asset","_type=asset&amp;edit_field="+o+"&amp;blog_id="+q+"&amp;dialog_view=1")}});h.addMTButton("mt_source_bold",{title:"mt_source_bold",text:"strong",mtButtonClass:"text",onclickFunctions:{source:"bold"}});h.addMTButton("mt_source_italic",{title:"mt_source_italic",text:"em",mtButtonClass:"text",onclickFunctions:{source:"italic"}});h.addMTButton("mt_source_blockquote",{title:"mt_source_blockquote",text:"blockquote",mtButtonClass:"text",onclickFunctions:{source:"blockquote"}});h.addMTButton("mt_source_unordered_list",{title:"mt_source_unordered_list",text:"ul",mtButtonClass:"text",onclickFunctions:{source:"insertUnorderedList"}});h.addMTButton("mt_source_ordered_list",{title:"mt_source_ordered_list",text:"ol",mtButtonClass:"text",onclickFunctions:{source:"insertOrderedList"}});h.addMTButton("mt_source_list_item",{title:"mt_source_list_item",text:"li",mtButtonClass:"text",onclickFunctions:{source:"insertListItem"}});h.addMTButton("mt_source_link",{title:"mt_insert_link",onclickFunctions:{source:function(z,y,C){h.focus();var w=h.windowManager.open;h.windowManager.open=function(E,F){E.body[0]["minWidth"]=263;var D=E.body.splice(1,E.body.length-1);if(d.source.isSupported("createLink",h.mtEditorStatus.format,"target")){E.body.push(D.pop())}return w.apply(this,arguments)};h.buttons.link.onclick();h.windowManager.open=w;var B=h.windowManager.windows[0],x=d.source.e.getSelectedText()||"",v=B.find("#target")[0];B.settings.data.text="-mt-dummy-initial-text";function A(D){if(D.command=="mceInsertContent"){d.source.execCommand("createLink",null,B.find("#href")[0].value(),{target:v?v.value():""});D.isDefaultPrevented=function(){return true};h.off("BeforeExecCommand",A)}}h.on("BeforeExecCommand",A);B.on("close",function(){h.off("BeforeExecCommand",A)})}}});h.addMTButton("mt_source_template",{title:"Template",onclickFunctions:{source:function(x,w,y){h.focus();h.buttons.template.onclick();function v(z){if(z.command=="mceInsertContent"){d.source.editor.insertContent(z.value);z.isDefaultPrevented=function(){return true};h.off("BeforeExecCommand",v)}}h.on("BeforeExecCommand",v);h.windowManager.windows[0].on("close",function(){h.off("BeforeExecCommand",v)})}}});h.addMTButton("mt_source_mode",{title:"mt_source_mode",onclickFunctions:{wysiwyg:function(){h.execCommand("mtSetFormat","none.tinymce_temp")},source:function(){h.execCommand("mtSetFormat","richtext")}},onPostRender:function(){var v=this;h.on("NodeChange",function(w){var x=h.mtEditorStatus,y=p.find(".mce-i-mt_source_mode").closest("div");if(h.mtEditorStatus.mode=="source"&&h.mtEditorStatus.format!="none.tinymce_temp"){y.css("display","none")}else{y.css("display","")}var z=h.mtEditorStatus.mode=="source"&&h.mtEditorStatus.format=="none.tinymce_temp";v.active(z);if(!h.mtProxies.source){return}i(h,h.controlManager)})}});h.on("MTSourceButtonClick",i)},getInfo:function(){return{longname:"MovableType",author:"Six Apart, Ltd",authorurl:"",infourl:"",version:"2.0"}}});tinymce.PluginManager.add("mt",tinymce.plugins.MovableType)})(jQuery);