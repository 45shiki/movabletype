(function(b){function a(d,c){b.fn.mtDialog.open(ScriptURI+"?__mode="+d+"&amp;"+c)}tinymce.Editor.prototype.addMtButton=function(e,f){var d=this;var g={};var c=f.onclickFunctions;if(c){f.onclick=function(){var i=d.mtEditorStatus.mode;var h=c[i];if(typeof(h)=="string"){d.mtProxies[i].execCommand(h)}else{h.apply(d,arguments)}if(i=="source"){d.onMTSourceButtonClick.dispatch(d,d.controlManager)}};for(k in c){g[k]=1}}else{g={wysiwyg:1,source:1}}if(!f.isSupported){f.isSupported=function(j,i){if(!g[j]){return false}if(c&&j=="source"){var h=c[j];if(typeof(h)=="string"){return d.mtProxies.source.isSupported(h,i)}else{return true}}else{return true}}}if(typeof(d.mtButtons)=="undefined"){d.mtButtons={}}d.mtButtons[e]=f;return d.addButton(e,f)};tinymce.ScriptLoader.add(tinymce.PluginManager.urls.mt+"/langs/en.js");tinymce.create("tinymce.plugins.MovableType",{init:function(m,c){tinymce.DOM.loadCSS(c+"/css/mt.css");var d=m.id;var j=b("#blog-id").val()||0;var l={};var n=[];var g={};function p(s,r){var q=s+"-"+r;if(!g[q]){g[q]={};b.each(m.mtButtons,function(t,u){if(u.isSupported(s,r)){g[q][t]=u}})}return g[q]}m.mtProxies=l;m.mtEditorStatus={mode:"wysiwyg",format:"richtext"};m.addCommand("mtGetStatus",function(){return m.mtEditorStatus});function e(){var q=m.mtEditorStatus;b.each(n,function(t,s){b("#"+s).show().removeClass("mce_mt_button_hidden").css({display:"block"});m.controlManager.setDisabled(this,false)});n=[];var r={};b.each(p(q.mode,q.format),function(t,s){r[d+"_"+t]=1});if(q.mode=="source"){l.source.setFormat(q.format);b.each(m.controlManager.controls,function(s,t){if(!t.classPrefix){return}if(!r[s]){b("#"+s).hide().addClass("mce_mt_button_hidden");n.push(s)}})}else{b.each(m.mtButtons,function(t,u){var s=d+"_"+t;if(!r[s]){b("#"+s).hide().addClass("mce_mt_button_hidden");n.push(s)}})}b("table","#"+d+"_toolbargroup").each(function(){var s=b(this);if(s.hasClass("mceSplitButton")){return}s.show();if(s.find("a.mceButton:not(.mce_mt_button_hidden)").length==0){s.hide()}});m.theme.resizeBy(0,0)}m.onInit.add(function(){e()});m.addCommand("mtSetStatus",function(q){b.extend(m.mtEditorStatus,q);e()});m.addCommand("mtGetProxies",function(){return l});m.addCommand("mtSetProxies",function(q){b.extend(l,q)});m.addMtButton("mt_font_size_smaller",{title:"mt.font_size_smaller",onclickFunctions:{wysiwyg:"fontSizeSmaller",source:"fontSizeSmaller"}});m.addMtButton("mt_font_size_larger",{title:"mt.font_size_larger",onclickFunctions:{wysiwyg:"fontSizeLarger",source:"fontSizeLarger"}});m.addMtButton("mt_bold",{title:"mt.bold",onclickFunctions:{wysiwyg:function(){m.execCommand("bold")},source:"bold"}});m.addMtButton("mt_italic",{title:"mt.italic",onclickFunctions:{wysiwyg:function(){m.execCommand("italic")},source:"italic"}});m.addMtButton("mt_underline",{title:"mt.underline",onclickFunctions:{wysiwyg:function(){m.execCommand("underline")},source:"underline"}});m.addMtButton("mt_strikethrough",{title:"mt.strikethrough",onclickFunctions:{wysiwyg:function(){m.execCommand("strikethrough")},source:"strikethrough"}});m.addMtButton("mt_insert_link",{title:"mt.insert_link",onclickFunctions:{wysiwyg:function(){var r=m.dom.getParent(m.selection.getNode(),"A");var q=!m.selection.isCollapsed();l.wysiwyg.execCommand("insertLink",null,{anchor:r,textSelected:q})},source:"insertLink"}});m.addMtButton("mt_insert_email",{title:"mt.insert_email",onclickFunctions:{wysiwyg:function(){var r=m.dom.getParent(m.selection.getNode(),"A");var q=!m.selection.isCollapsed();l.wysiwyg.execCommand("insertEmail",null,{anchor:r,textSelected:q})},source:"insertEmail"}});m.addMtButton("mt_indent",{title:"mt.indent",onclickFunctions:{wysiwyg:function(){m.execCommand("indent")},source:"indent"}});m.addMtButton("mt_outdent",{title:"mt.outdent",onclickFunctions:{wysiwyg:function(){m.execCommand("outdent")}}});m.addMtButton("mt_insert_unordered_list",{title:"mt.insert_unordered_list",onclickFunctions:{wysiwyg:function(){m.execCommand("insertUnorderedList")},source:"insertUnorderedList"}});m.addMtButton("mt_insert_ordered_list",{title:"mt.insert_ordered_list",onclickFunctions:{wysiwyg:function(){m.execCommand("insertOrderedList")},source:"insertOrderedList"}});m.addMtButton("mt_justify_left",{title:"mt.justify_left",onclickFunctions:{wysiwyg:function(){m.execCommand("justifyLeft")},source:"justifyLeft"}});m.addMtButton("mt_justify_center",{title:"mt.justify_center",onclickFunctions:{wysiwyg:function(){m.execCommand("justifyCenter")},source:"justifyCenter"}});m.addMtButton("mt_justify_right",{title:"mt.justify_right",onclickFunctions:{wysiwyg:function(){m.execCommand("justifyRight")},source:"justifyRight"}});m.addMtButton("mt_insert_image",{title:"mt.insert_image",onclick:function(){a("dialog_list_asset","_type=asset&amp;edit_field="+d+"&amp;blog_id="+j+"&amp;dialog_view=1&amp;filter=class&amp;filter_val=image")}});m.addMtButton("mt_insert_file",{title:"mt.insert_file",onclick:function(){a("dialog_list_asset","_type=asset&amp;edit_field="+d+"&amp;blog_id="+j+"&amp;dialog_view=1")}});m.addMtButton("mt_source_bold",{title:"mt.bold",onclickFunctions:{source:"bold"}});m.addMtButton("mt_source_italic",{title:"mt.italic",onclickFunctions:{source:"italic"}});m.addMtButton("mt_source_blockquote",{title:"mt.blockquote",onclickFunctions:{source:"blockquote"}});m.addMtButton("mt_source_unordered_list",{title:"mt.insert_unordered_list",onclickFunctions:{source:"insertUnorderedList"}});m.addMtButton("mt_source_ordered_list",{title:"mt.insert_ordered_list",onclickFunctions:{source:"insertOrderedList"}});m.addMtButton("mt_source_list_item",{title:"mt.list_item",onclickFunctions:{source:"insertListItem"}});function i(q){b.each(m.windowManager.windows,function(s,r){var t=r.iframeElement;b("#"+t.id).load(function(){var v=this.contentWindow;var u={"$contents":b(this).contents(),window:v};q(u,function(){v.tinyMCEPopup.close();if(tinymce.isWebKit){b("#convert_breaks").focus()}l.source.focus()})})})}function o(s,q){function r(){var t=b(this);l.source.execCommand("createLink",null,t.find("#href").val(),{target:t.find("#target_list").val(),title:t.find("#linktitle").val()});q()}s["$contents"].find("form").attr("onsubmit","").submit(r);if(!l.source.isSupported("createLink",m.mtEditorStatus.format,"target")){s["$contents"].find("#targetlistlabel").closest("tr").hide()}}m.addMtButton("mt_source_link",{title:"mt.source_link",onclickFunctions:{source:function(r,q,s){tinymce._setActive(m);this.theme._mceLink.apply(this.theme);i(o)}}});m.addMtButton("mt_source_mode",{title:"mt.source_mode",onclickFunctions:{wysiwyg:function(){m.execCommand("mtSetFormat","none.tinymce_temp")},source:function(){m.execCommand("mtSetFormat","richtext")}}});var f={mt_bold:"bold",mt_italic:"italic",mt_underline:"underline",mt_strikethrough:"strikethrough",mt_justify_left:"justifyleft",mt_justify_center:"justifycenter",mt_justify_right:"justifyright"};m.onNodeChange.add(function(t,q,x,w,r){var u=t.mtEditorStatus;if(u.mode=="wysiwyg"){b.each(f,function(y,s){q.setActive(y,t.queryCommandState(s))});q.setDisabled("mt_outdent",!t.queryCommandState("Outdent"))}if(t.getParam("fullscreen_is_enabled")){q.setDisabled("mt_source_mode",true)}else{if(t.mtEditorStatus.mode=="source"&&t.mtEditorStatus.format!="none.tinymce_temp"){b("#"+d+"_mt_source_mode").hide()}else{b("#"+d+"_mt_source_mode").show()}var v=t.mtEditorStatus.mode=="source"&&t.mtEditorStatus.format=="none.tinymce_temp";q.setActive("mt_source_mode",v)}if(!t.mtProxies.source){return}b.each(h,function(s,y){q.setActive(s,t.mtProxies.source.isStateActive(y))})});if(!m.onMTSourceButtonClick){m.onMTSourceButtonClick=new tinymce.util.Dispatcher(m)}var h={mt_source_bold:"bold",mt_source_italic:"italic",mt_source_blockquote:"blockquote",mt_source_unordered_list:"insertUnorderedList",mt_source_ordered_list:"insertOrderedList",mt_source_list_item:"insertListItem",mt_source_link:"createLink",};m.onMTSourceButtonClick.add(function(r,q){b.each(h,function(s,t){q.setActive(s,r.mtProxies.source.isStateActive(t))})})},getInfo:function(){return{longname:"MovableType",author:"Six Apart, Ltd",authorurl:"",infourl:"",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("mt",tinymce.plugins.MovableType)})(jQuery);