(function(a){tinymce.ScriptLoader.add(tinymce.PluginManager.urls.mt+"/langs/en.js");tinymce.Editor.prototype.addMTButton=function(d,e){var c=this;var f={};var b=e.onclickFunctions;if(b){e.onclick=function(){var h=c.mtEditorStatus.mode;var g=b[h];if(typeof(g)=="string"){c.mtProxies[h].execCommand(g)}else{g.apply(c,arguments)}if(h=="source"){c.onMTSourceButtonClick.dispatch(c,c.controlManager)}};for(k in b){f[k]=1}}else{f={wysiwyg:1,source:1}}if(!e.isSupported){e.isSupported=function(i,h){if(!f[i]){return false}if(b&&i=="source"){var g=b[i];if(typeof(g)=="string"){return c.mtProxies.source.isSupported(g,h)}else{return true}}else{return true}}}if(typeof(c.mtButtons)=="undefined"){c.mtButtons={}}c.mtButtons[d]=e;return c.addButton(d,e)};tinymce.create("tinymce.ui.MTTextButton:tinymce.ui.Button",{renderHTML:function(){var e=tinymce.DOM;var f=this.classPrefix,d=this.settings,c,b;b=e.encode(d.label||"");c='<a role="button" id="'+this.id+'" href="javascript:;" class="mceMTTextButton '+f+" "+f+"Enabled "+d["class"]+(b?" "+f+"Labeled":"")+'" onmousedown="return false;" onclick="return false;" aria-labelledby="'+this.id+'_voice">';c+=d.title;c+="</a>";return c}});tinymce.create("tinymce.plugins.MovableType",{buttonSettings:"",initButtonSettings:function(b){var e=this;e.buttonIDs={};var d={source:{},wysiwyg:{}};var c=1;a.each(["common","source","wysiwyg"],function(h,f){var l="plugin_mt_"+f+"_buttons";for(var g=1;b.settings[l+g];g++){e.buttonSettings+=(e.buttonSettings?",":"")+b.settings[l+g];b.settings["theme_advanced_buttons"+c]=b.theme.settings["theme_advanced_buttons"+c]=b.settings[l+g];if(f=="common"){d.source[c-1]=d.wysiwyg[c-1]=1}else{d[f][c-1]=1}c++}});return d},init:function(h,g){var e=this;var o=h.id;var c=o.length;var q=a("#blog-id").val()||0;var d={};var m=[];var p=null;var f={};var t=this.initButtonSettings(h);h.mtProxies=d;h.mtEditorStatus={mode:"wysiwyg",format:"richtext"};function r(w,v){var u=w+"-"+v;if(!f[u]){f[u]={};a.each(h.mtButtons,function(x,y){if(y.isSupported(w,v)){f[u][x]=y}})}return f[u]}function b(){var u=h.mtEditorStatus;a.each(m,function(y,x){p.find(".mce_"+x).css({display:""}).removeClass("mce_mt_button_hidden");h.controlManager.setDisabled(this,false)});m=[];var v=r(u.mode,u.format);function w(x){if(!v[x]){p.find(".mce_"+x).css({display:"none"}).addClass("mce_mt_button_hidden");m.push(x)}}if(u.mode=="source"){d.source.setFormat(u.format);a.each(h.controlManager.controls,function(x,y){if(!y.classPrefix){return}w(x.substr(c+1))})}else{a.each(h.mtButtons,function(x,y){w(x)})}a("#"+o+"_toolbargroup > span > table").each(function(x){if(t[u.mode][x]){a(this).show()}else{a(this).hide()}})}function s(v,u){a.fn.mtDialog.open(ScriptURI+"?__mode="+v+"&amp;"+u)}function i(u){a.each(h.windowManager.windows,function(x,v){var y=v.iframeElement;a("#"+y.id).load(function(){var z=this.contentWindow;var w={"$contents":a(this).contents(),window:z};u(w,function(){z.tinyMCEPopup.close();if(tinymce.isWebKit){a("#convert_breaks").focus()}d.source.focus()})})})}function l(w,u){function v(){var x=a(this);d.source.execCommand("createLink",null,x.find("#href").val(),{target:x.find("#target_list").val(),title:x.find("#linktitle").val()});u()}w["$contents"].find("form").attr("onsubmit","").submit(v);if(!d.source.isSupported("createLink",h.mtEditorStatus.format,"target")){w["$contents"].find("#targetlistlabel").closest("tr").hide()}}h.onInit.add(function(){p=a(h.getContainer());b();h.theme.resizeBy(0,0)});h.addCommand("mtGetStatus",function(){return h.mtEditorStatus});h.addCommand("mtSetStatus",function(u){a.extend(h.mtEditorStatus,u);b()});h.addCommand("mtGetProxies",function(){return d});h.addCommand("mtSetProxies",function(u){a.extend(d,u)});h.addMTButton("mt_font_size_smaller",{title:"mt.font_size_smaller",onclickFunctions:{wysiwyg:"fontSizeSmaller",source:"fontSizeSmaller"}});h.addMTButton("mt_font_size_larger",{title:"mt.font_size_larger",onclickFunctions:{wysiwyg:"fontSizeLarger",source:"fontSizeLarger"}});h.addMTButton("mt_bold",{title:"mt.bold",onclickFunctions:{wysiwyg:function(){h.execCommand("bold")},source:"bold"}});h.addMTButton("mt_italic",{title:"mt.italic",onclickFunctions:{wysiwyg:function(){h.execCommand("italic")},source:"italic"}});h.addMTButton("mt_underline",{title:"mt.underline",onclickFunctions:{wysiwyg:function(){h.execCommand("underline")},source:"underline"}});h.addMTButton("mt_strikethrough",{title:"mt.strikethrough",onclickFunctions:{wysiwyg:function(){h.execCommand("strikethrough")},source:"strikethrough"}});h.addMTButton("mt_insert_link",{title:"mt.insert_link",onclickFunctions:{wysiwyg:function(){var v=h.dom.getParent(h.selection.getNode(),"A");var u=!h.selection.isCollapsed();d.wysiwyg.execCommand("insertLink",null,{anchor:v,textSelected:u})},source:"insertLink"}});h.addMTButton("mt_insert_email",{title:"mt.insert_email",onclickFunctions:{wysiwyg:function(){var v=h.dom.getParent(h.selection.getNode(),"A");var u=!h.selection.isCollapsed();d.wysiwyg.execCommand("insertEmail",null,{anchor:v,textSelected:u})},source:"insertEmail"}});h.addMTButton("mt_indent",{title:"mt.indent",onclickFunctions:{wysiwyg:function(){h.execCommand("indent")},source:"indent"}});h.addMTButton("mt_outdent",{title:"mt.outdent",onclickFunctions:{wysiwyg:function(){h.execCommand("outdent")}}});h.addMTButton("mt_insert_unordered_list",{title:"mt.insert_unordered_list",onclickFunctions:{wysiwyg:function(){h.execCommand("insertUnorderedList")},source:"insertUnorderedList"}});h.addMTButton("mt_insert_ordered_list",{title:"mt.insert_ordered_list",onclickFunctions:{wysiwyg:function(){h.execCommand("insertOrderedList")},source:"insertOrderedList"}});h.addMTButton("mt_justify_left",{title:"mt.justify_left",onclickFunctions:{wysiwyg:function(){h.execCommand("justifyLeft")},source:"justifyLeft"}});h.addMTButton("mt_justify_center",{title:"mt.justify_center",onclickFunctions:{wysiwyg:function(){h.execCommand("justifyCenter")},source:"justifyCenter"}});h.addMTButton("mt_justify_right",{title:"mt.justify_right",onclickFunctions:{wysiwyg:function(){h.execCommand("justifyRight")},source:"justifyRight"}});h.addMTButton("mt_insert_image",{title:"mt.insert_image",onclick:function(){s("dialog_list_asset","_type=asset&amp;edit_field="+o+"&amp;blog_id="+q+"&amp;dialog_view=1&amp;filter=class&amp;filter_val=image")}});h.addMTButton("mt_insert_file",{title:"mt.insert_file",onclick:function(){s("dialog_list_asset","_type=asset&amp;edit_field="+o+"&amp;blog_id="+q+"&amp;dialog_view=1")}});h.addMTButton("mt_source_bold",{title:"strong",mtButtonClass:"text",onclickFunctions:{source:"bold"}});h.addMTButton("mt_source_italic",{title:"em",mtButtonClass:"text",onclickFunctions:{source:"italic"}});h.addMTButton("mt_source_blockquote",{title:"blockquote",mtButtonClass:"text",onclickFunctions:{source:"blockquote"}});h.addMTButton("mt_source_unordered_list",{title:"ul",mtButtonClass:"text",onclickFunctions:{source:"insertUnorderedList"}});h.addMTButton("mt_source_ordered_list",{title:"ol",mtButtonClass:"text",onclickFunctions:{source:"insertOrderedList"}});h.addMTButton("mt_source_list_item",{title:"li",mtButtonClass:"text",onclickFunctions:{source:"insertListItem"}});h.addMTButton("mt_source_link",{title:"mt.insert_link",onclickFunctions:{source:function(v,u,w){tinymce._setActive(h);this.theme._mceLink.apply(this.theme);i(l)}}});h.addMTButton("mt_source_mode",{title:"mt.source_mode",onclickFunctions:{wysiwyg:function(){h.execCommand("mtSetFormat","none.tinymce_temp")},source:function(){h.execCommand("mtSetFormat","richtext")}}});var n={mt_bold:"bold",mt_italic:"italic",mt_underline:"underline",mt_strikethrough:"strikethrough",mt_justify_left:"justifyleft",mt_justify_center:"justifycenter",mt_justify_right:"justifyright"};a.each(n,function(w,u){if(e.buttonSettings.indexOf(w)==-1){delete n[w]}});h.onNodeChange.add(function(w,u,A,z,v){var x=w.mtEditorStatus;if(x.mode=="wysiwyg"){a.each(n,function(C,B){u.setActive(C,w.queryCommandState(B))});u.setDisabled("mt_outdent",!w.queryCommandState("Outdent"))}if(w.mtEditorStatus.mode=="source"&&w.mtEditorStatus.format!="none.tinymce_temp"){a("#"+o+"_mt_source_mode").css("display","none")}else{a("#"+o+"_mt_source_mode").css("display","")}var y=w.mtEditorStatus.mode=="source"&&w.mtEditorStatus.format=="none.tinymce_temp";u.setActive("mt_source_mode",y);if(!w.mtProxies.source){return}a.each(j,function(B,C){u.setActive(B,w.mtProxies.source.isStateActive(C))})});if(!h.onMTSourceButtonClick){h.onMTSourceButtonClick=new tinymce.util.Dispatcher(h)}var j={mt_source_bold:"bold",mt_source_italic:"italic",mt_source_blockquote:"blockquote",mt_source_unordered_list:"insertUnorderedList",mt_source_ordered_list:"insertOrderedList",mt_source_list_item:"insertListItem",mt_source_link:"createLink"};a.each(j,function(w,u){if(e.buttonSettings.indexOf(w)==-1){delete n[w]}});h.onMTSourceButtonClick.add(function(v,u){a.each(j,function(w,x){u.setActive(w,v.mtProxies.source.isStateActive(x))})})},createControl:function(d,b){var g=b.editor;var h=g.buttons[d];if((d=="mt_insert_image")||(d=="mt_insert_file")){if(!this.buttonIDs[d]){this.buttonIDs[d]=[]}var i=d+"_"+this.buttonIDs[d].length;this.buttonIDs[d].push(i);return b.createButton(i,a.extend({},h,{"class":"mce_"+d}))}if(h&&h.mtButtonClass){var f,c,e;switch(h.mtButtonClass){case"text":c=tinymce.ui.MTTextButton;break;default:throw new Error("Not implemented:"+h.mtButtonClass)}if(b._cls.button){e=b._cls.button}b._cls.button=c;f=b.createButton(d,a.extend({},h));if(e!=="undefined"){b._cls.button=e}return f}return null},getInfo:function(){return{longname:"MovableType",author:"Six Apart, Ltd",authorurl:"",infourl:"",version:"1.0"}}});tinymce.PluginManager.add("mt",tinymce.plugins.MovableType)})(jQuery);